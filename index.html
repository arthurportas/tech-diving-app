<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>B√ºhlmann ZH-L16C Decompression Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="stylesheet" href="src/styles.css">
<script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>

<div class="container">
  <header>
    <h1>B√ºhlmann ZH-L16C Decompression Planner</h1>
    <p>Calculate safe decompression stops with advanced tissue modeling</p>
  </header>

  <!-- Input Panel -->
  <div class="panel">
    <!-- Dive Parameters Section -->
    <div class="section-group">
      <div class="section-title">‚õµ Dive Profile</div>
      <div class="input-grid">
        <div class="input-group">
          <label id="depthLabel">Max Depth (m)</label>
          <input id="depth" type="number" value="60">
        </div>
        <div class="input-group">
          <label id="timeLabel">Bottom Time (min)</label>
          <input id="time" type="number" value="20">
        </div>
      </div>
    </div>

    <!-- Gas Configuration Section -->
    <div class="section-group">
      <div class="section-title">‚õΩ Gas Configuration</div>
      <div class="input-grid">
        <div class="input-group">
          <label>Bottom Gas</label>
          <select id="gas">
            <option value="18/45">Trimix 18/45</option>
            <option value="21/35">Trimix 21/35</option>
            <option value="28">Nitrox 28</option>
            <option value="32">Nitrox 32</option>
            <option value="air">Air</option>
            <option value="custom">Custom</option>
          </select>
        </div>
      </div>

      <div id="customGasContainer" style="display: none;">
        <label>Gas Type</label>
        <select id="customType">
          <option value="nitrox">Nitrox</option>
          <option value="trimix">Trimix</option>
        </select>
        <div id="nitroxInputs">
          <label>O‚ÇÇ %</label>
          <input id="customO2" type="number" min="21" max="100" step="1" value="32">
        </div>
        <div id="trimixInputs" style="display: none;">
          <label>O‚ÇÇ %</label>
          <input id="customTrimixO2" type="number" min="10" max="50" step="1" value="18">
          <label>He %</label>
          <input id="customHe" type="number" min="0" max="80" step="1" value="45">
        </div>
      </div>

      <label class="checkbox-label" style="margin-top: 1rem;">
        <input type="checkbox" id="noGasSwitch">
        No gas switch (use bottom gas for entire dive)
      </label>

      <div id="decoGasContainer">
        <label id="decoGasLabel">Deco Gas</label>
        <select id="decoGasType">
          <option value="ean">EAN</option>
          <option value="o2">O‚ÇÇ</option>
          <option value="ean+o2">EAN + O‚ÇÇ</option>
        </select>

        <div id="eanO2Container">
          <label>Deco Gas %</label>
          <input id="decoO2" type="number" min="21" max="100" step="1" value="50">
        </div>

        <div id="o2ShallowContainer" style="display: none;">
          <label class="checkbox-label">
            <input type="checkbox" id="useO2Shallow" checked>
            Use pure O‚ÇÇ for shallow stops (6m and shallower)
          </label>
        </div>
      </div>
    </div>

    <!-- Decompression Settings Section -->
    <div class="section-group">
      <div class="section-title">üìä Decompression Settings</div>
      <div class="input-grid">
        <div class="input-group">
          <label id="gfLowLabel">GF Low</label>
          <input id="gfLow" type="number" step="1" value="30">
        </div>
        <div class="input-group">
          <label id="gfHighLabel">GF High</label>
          <input id="gfHigh" type="number" step="1" value="85">
        </div>
      </div>
    </div>

    <button id="planBtn">Plan Dive</button>
  </div>

  <!-- Results Panel -->
  <div class="panel">
    <h3>üìã Decompression Schedule</h3>
    <div style="overflow-x: auto;">
      <table>
        <thead>
          <tr>
            <th id="depthHeader">Depth (m)</th>
            <th>Time (min)</th>
            <th>Gas</th>
          </tr>
        </thead>
        <tbody id="output"></tbody>
      </table>
    </div>
    <div id="totalRuntime" class="total-runtime"></div>

    <!-- Strategy Comparison -->
    <div class="section-group">
      <div class="section-title">üß™ Strategy Comparison</div>
      <div class="input-grid">
        <label class="checkbox-label"><input type="checkbox" id="compareLinear"> Linear</label>
        <label class="checkbox-label"><input type="checkbox" id="compareSCurve"> S-curve</label>
        <label class="checkbox-label"><input type="checkbox" id="compareExponential"> Exponential</label>
      </div>
      <div id="strategyCards" class="strategy-cards"></div>
    </div>
    
    <!-- Dive Profile Graph (Collapsible) -->
    <div class="graph-section collapsed">
      <div class="graph-header">
        <span class="toggle-arrow">‚ñº</span>
        <h4>üìà Dive Ascent Profile</h4>
      </div>
      <div id="graphContainer" class="graph-container">
        <svg id="diveProfileChart" style="width: 100%; height: 500px;"></svg>
      </div>
    </div>
    
    <div id="detailedSchedule" class="detailed-schedule"></div>
    
    <!-- Full Dive Schedule Profile Graph (Collapsible) -->
    <div class="graph-section collapsed">
      <div class="graph-header">
        <span class="toggle-arrow">‚ñº</span>
        <h4>üìä Dive Schedule Profile</h4>
      </div>
      <div id="fullGraphContainer" class="graph-container">
        <svg id="fullDiveProfileChart" style="width: 100%; height: 500px;"></svg>
      </div>
    </div>
    
    <!-- Tissue Compartment Visualization (Collapsible) -->
    <div class="graph-section collapsed">
      <div class="graph-header">
        <span class="toggle-arrow">‚ñº</span>
        <h4>üß¨ Tissue Compartment Analysis</h4>
      </div>
      <div class="graph-container">
        <div id="tissueVisualization" class="tissue-visualization"></div>
      </div>
    </div>

    <!-- Tissue Saturation Timeline (Collapsible) -->
    <div class="graph-section collapsed">
      <div class="graph-header">
        <span class="toggle-arrow">‚ñº</span>
        <h4>üì∫ Tissue Saturation Timeline</h4>
      </div>
      <div class="graph-container">
        <p class="small" style="margin-bottom: 1rem; color: var(--text-secondary);">Interactive heatmap showing all 16 tissue compartments (rows) across dive time (columns). Color intensity represents saturation relative to M-values. Hover for details.</p>
        <svg id="timelineSaturationChart" style="width: 100%; height: 700px;"></svg>
      </div>
    </div>
    
    <p class="small">‚ö†Ô∏è Educational use only. Not for real dive planning.</p>
  </div>
</div>

<!-- Floating Settings Button -->
<button id="settingsBtn">‚öôÔ∏è</button>

<!-- Settings Panel -->
<div id="settingsPanel" class="settings-panel">
  <div class="settings-content">
    <button id="closeSettings">‚úï</button>
    <h4>Dive Planning Settings</h4>

    <label>Units</label>
    <select id="units">
      <option value="metric">Metric</option>
      <option value="imperial">Imperial</option>
    </select>

    <label id="ascentModeLabel">Ascent Rate Mode</label>
    <select id="ascentMode">
      <option value="single">Single Rate</option>
      <option value="multi">Multiple Rates</option>
    </select>

    <div id="singleAscent">
      <label id="ascentRateLabel">Ascent Rate (m/min)</label>
      <input id="ascentRate" type="number" value="10">
    </div>

    <div id="multiAscent" style="display: none;">
      <label id="deepAscentRateLabel">Deep Ascent Rate (m/min)</label>
      <input id="deepAscentRate" type="number" value="6">
      <label id="shallowThresholdLabel">Shallow Depth Threshold (m)</label>
      <input id="shallowThreshold" type="number" value="21">
      <label id="shallowAscentRateLabel">Shallow Ascent Rate (m/min)</label>
      <input id="shallowAscentRate" type="number" value="9">
    </div>

    <label id="lastStopDepthLabel">Last Stop Depth (m)</label>
    <select id="lastStopDepth">
      <option value="3">3</option>
      <option value="6" selected>6</option>
    </select>

    <label id="descentRateLabel">Descent Rate (m/min)</label>
    <input id="descentRate" type="number" min="1" max="50" step="1" value="20">
  </div>
</div>

<!-- Tissue Compartment Information Section -->
<section id="tissueSection" class="tissue-section" style="display: none;">
  <h2 class="section-title">üß¨ Tissue Compartment Information</h2>
  
  <p class="tissue-intro">
    The B√ºhlmann ZH-L16C model uses 16 theoretical tissue compartments with different nitrogen and helium uptake/release rates. 
    Each compartment represents tissue types ranging from fast (blood, brain) to slow (bone, cartilage).
  </p>
  
  <!-- Phase selector for tissue snapshots -->
  <div class="phase-selector">
    <label for="tissuePhaseSelect">View tissue loading at:</label>
    <select id="tissuePhaseSelect">
      <option value="0">Bottom Time</option>
    </select>
  </div>
  
  <!-- Tissue Bar Graph -->
  <div class="graph-section">
    <div class="graph-header">
      <h3>üìä Tissue Loading Bar Graph</h3>
      <span class="toggle-arrow">‚ñº</span>
    </div>
    <div class="graph-container">
      <svg id="tissueBarChart" width="100%" height="800"></svg>
    </div>
  </div>
  
  <!-- Tissue Loading Over Time (Future) -->
  <div class="graph-section collapsed">
    <div class="graph-header">
      <h3>üìà Tissue Loading Timeline</h3>
      <span class="toggle-arrow">‚ñº</span>
    </div>
    <div class="graph-container">
      <div class="placeholder-content">
        <p>Coming soon: Interactive timeline showing tissue saturation changes throughout the entire dive profile.</p>
      </div>
    </div>
  </div>
  
  <div class="tissue-disclaimer">
    ‚ö†Ô∏è <strong>Educational Use Only:</strong> This visualization is for educational purposes. 
    Always use certified dive computers and follow proper decompression procedures.
  </div>
</section>

<script type="module" src="src/main.js"></script>

</body>
</html>
